<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Usage Counter</title>
<style>
  :root {
    --bg: #f7f7f8;
    --card: #ffffff;
    --text: #1f2937;
    --muted: #6b7280;
    --accent: #111827;
    --border: #e5e7eb;
    --danger: #b91c1c;
    --warn: #92400e;
    --focus: #2563eb;
  }
  body {
    margin: 0;
    background: radial-gradient(1000px 500px at 50% -200px, #ffffff, var(--bg));
    font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    color: var(--text);
  }
  .wrap {
    display: grid;
    place-items: center;
    min-height: 100vh;
    padding: 24px;
  }
  .card {
    max-width: 560px;
    width: 100%;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
  }
  h1 { margin: 0 0 10px; font-size: 20px; }
  p.sub { margin: 0 0 16px; font-size: 14px; color: var(--muted); }

  input[type="text"] {
    flex: 1;
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: 10px;
    font-size: 16px;
  }
  input:focus {
    border-color: var(--focus);
    outline: none;
    box-shadow: 0 0 0 3px rgba(37,99,235,0.12);
  }
  .row { display: flex; gap: 8px; margin-bottom: 12px; }
  .controls { display: flex; gap: 8px; margin-bottom: 16px; }

  button {
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 12px;
    font-weight: 600;
    background: #fff;
    cursor: pointer;
    transition: all 0.15s ease;
  }
  button:hover:not(:disabled) {
    transform: translateY(-1px);
    border-color: #d1d5db;
    box-shadow: 0 6px 16px rgba(0,0,0,0.06);
  }
  button:disabled { opacity: 0.55; cursor: not-allowed; }

  .count {
    display: flex;
    align-items: baseline;
    gap: 10px;
    margin: 16px 0 8px;
  }
  .count .num { font-size: 36px; font-weight: 800; }
  .count .label { font-size: 14px; color: var(--muted); }

  .status { min-height: 22px; font-size: 14px; margin-top: 4px; }
  .status.warn { color: var(--warn); }
  .status.error { color: var(--danger); }
  .foot { margin-top: 12px; font-size: 13px; color: var(--muted); }
</style>
</head>
<body>
<div class="wrap">
  <main class="card">
    <h1>Usage Counter</h1>
    <p class="sub">Enter a name, press <strong>Start</strong> to save it. Increment, Refresh, or Forget as needed.</p>

    <div class="row">
      <input id="nameInput" placeholder="Name (e.g., alice)" />
      <button id="startBtn">Start</button>
    </div>

    <div class="controls">
      <button id="incBtn" disabled>Increment</button>
      <button id="refreshBtn" disabled>Refresh</button>
      <button id="forgetBtn" disabled>Forget</button>
    </div>

    <div class="count">
      <div class="num" id="countNum">–</div>
      <div class="label">current count</div>
    </div>

    <div class="status" id="status"></div>
    <div class="foot" id="hint">No name set.</div>
  </main>
</div>

<script>
(() => {
  const API = "https://api.magiqspark.com/counter/";
  const els = {
    name: document.getElementById("nameInput"),
    start: document.getElementById("startBtn"),
    inc: document.getElementById("incBtn"),
    refresh: document.getElementById("refreshBtn"),
    forget: document.getElementById("forgetBtn"),
    count: document.getElementById("countNum"),
    status: document.getElementById("status"),
    hint: document.getElementById("hint")
  };
  let savedName = null;

  function setStatus(msg, type="") {
    els.status.className = "status " + type;
    els.status.textContent = msg;
  }
  function updateUI() {
    const has = !!savedName;
    els.name.disabled = has;
    els.start.disabled = !els.name.value.trim() || has;
    els.inc.disabled = els.refresh.disabled = els.forget.disabled = !has;
    els.hint.textContent = has ? `Using name “${savedName}”.` : "No name set.";
  }

  async function doPost(name) {
    try {
      const r = await fetch(API, { method:"POST", headers:{'Content-Type':'application/json'}, body: JSON.stringify({name}) });
      if (!r.ok) { setStatus("Increment failed", "error"); return false; }
      return true;
    } catch { setStatus("Network issue while incrementing", "warn"); return false; }
  }
  async function doGet(name) {
    try {
      const r = await fetch(API+"?name="+encodeURIComponent(name));
      if (!r.ok) { setStatus("Refresh failed", "error"); return; }
      const d = await r.json();
      els.count.textContent = d.count ?? "–";
      setStatus("");
    } catch { setStatus("Network issue while refreshing", "warn"); }
  }

  async function start() {
    savedName = els.name.value.trim();
    updateUI();
    await doPost(savedName);
    await doGet(savedName);
  }
  async function inc() { if (await doPost(savedName)) doGet(savedName); }
  function refresh() { doGet(savedName); }
  function forget() { savedName=null; els.name.value=""; els.count.textContent="–"; setStatus(""); updateUI(); }

  els.start.onclick = start;
  els.inc.onclick = inc;
  els.refresh.onclick = refresh;
  els.forget.onclick = forget;
  els.name.oninput = updateUI;

  // ?name=foo auto start
  const qn = new URLSearchParams(location.search).get("name");
  if (qn) { els.name.value = qn; start(); } else updateUI();
})();
</script>
</body>
</html>
